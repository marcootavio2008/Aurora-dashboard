{% extends "base.html" %}
{% block page_title %} ConfiguraÃ§Ãµes {% endblock %}

{% block content %}

<h1 class="page-title"> ğŸ‘¤ PERFIL </h1>

<div class="card">
  <div class="row">
    <div class="field">
      <label>Nome exibido</label>
      <input type="text" id="nome" placeholder="Ex: JoÃ£o">
    </div>

  <div class="row">
    <div class="field">
      <label>Senha</label>
      <input type="text" id="senha" placeholder="Ex: 1234">
    </div>

  <div class="row">
    <div class="field">
      <label>PermissÃ£o</label>
      <input type="text" id="role" placeholder="admin ou visitante">
    </div>

    <h1>ğŸ  CASAS</h1>

<div class="card">
  <label>Casa ativa</label>
  <select id="houseSelect"></select>

  <button onclick="selecionarCasa()">Selecionar</button>

  <hr>

  <label>Nova casa</label>
  <input type="text" id="newHouseName" placeholder="Ex: Casa da Praia">
  <button onclick="criarCasa()">Adicionar Casa</button>
</div>


<div class="actions">
  <button class="btn-secondary">Cancelar</button>
  <button class="btn-primary" onclick="salvarConfiguracoes()">
    Salvar ConfiguraÃ§Ãµes
  </button>
</div>

<h2>-------------------------------</h2> 


<h1> ğŸ‘¥ USUÃRIOS </h1>
<table id="usersTable">
  <thead>
    <tr>
      <th>UsuÃ¡rio</th>
      <th>Perfil</th>
      <th>AÃ§Ã£o</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>


<script>

async function carregarCasas() {
  const res = await fetch("/api/houses");
  const houses = await res.json();

  const select = document.getElementById("houseSelect");
  select.innerHTML = "";

  houses.forEach(h => {
    const opt = document.createElement("option");
    opt.value = h.id;
    opt.textContent = h.name;
    select.appendChild(opt);
  });
}

async function selecionarCasa() {
  const house_id = document.getElementById("houseSelect").value;

  await fetch("/api/houses/select", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ house_id })
  });

  alert("Casa selecionada!");
}

async function criarCasa() {
  const name = document.getElementById("newHouseName").value;

  await fetch("/api/houses", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ name })
  });

  carregarCasas();
}

carregarCasas();
  
async function carregarUsuarios() {
  const res = await fetch("/api/users");
  const users = await res.json();

  const tbody = document.querySelector("#usersTable tbody");
  tbody.innerHTML = "";

  users.forEach(u => {
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${u.username}</td>
      <td>${u.role}</td>
      <td>
        <button onclick="apagarUsuario(${u.id})">ğŸ—‘ Apagar</button>
      </td>
    `;

    tbody.appendChild(tr);
  });
}

async function apagarUsuario(id) {
  if (!confirm("Tem certeza que deseja apagar este usuÃ¡rio?")) return;

  const res = await fetch(`/api/users/${id}`, {
    method: "DELETE"
  });

  if (res.ok) {
    carregarUsuarios();
  } else {
    alert("Erro ao apagar usuÃ¡rio");
  }
}

carregarUsuarios();
</script>

<script src="/static/settings.js"></script>

{% endblock %}
